---
title: "aquaculture_mapping"
author: "Robert Saldivar"
date: "4/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
#Loading Packages

library(tidyverse)
library(here)
library(janitor)
library(tmap)
library(tmaptools)
library(ggmap)
library(sf)
library(sp)
library(leaflet)
library(rgdal)
library(rgeos)
```

```{r, message = FALSE}
#Reading in data

data_goals <- read_csv("data_goals.csv")
data_end_users <- read_csv("data_end_users.csv")
scores_clean <- read_csv("scores_clean.csv")

#reading in county shape files for CA, OR, and WA these will be used for basemaps
ca_counties <- read_sf(dsn = here("locations"), layer = "CA_counties")
or_counties <- read_sf(dsn = here("locations"), layer = "OR_counties")
wa_counties <- read_sf(dsn = here("locations"), layer = "WA_counties")
nv_counties <- read_sf(dsn = here("locations"), layer = "NV_counties")

```

```{r}
#This code chunk is going to be where I dissolve the counties of each state so that I am left with only the outline of the state.

ca_counties$area <- st_area(ca_counties)
ca_counties

ca <- ca_counties %>%
  summarise(area = sum(area))

or_counties$area <- st_area(or_counties)
or <- or_counties %>%
  summarise(area = sum(area))

wa_counties$area <- st_area(wa_counties)
wa <- wa_counties %>%
  summarise(area = sum(area))

nv_counties$area <- st_area(nv_counties)
nv <- nv_counties %>%
  summarise(area = sum(area))


```


```{r, message=FALSE}
#Cleaning and wrangling the data

data_scores <- full_join(data_goals, scores_clean)


estuary_sf <- data_scores %>%
  drop_na("Long") %>%
  st_as_sf(coords = c("Long", "Lat"), crs = 4326) %>%
  clean_names()

```

```{r}
#Making an interactive map with tmap

snapp_estuary_map <- tm_shape(estuary_sf) +
  tm_dots(labels = "estuary_or_subbasin", col = "green", size = 0.1)

basemap <- tm_basemap("Esri.WorldImagery")

tmap_mode("view")
snapp_estuary_map +
  basemap


```

```{r}
#This is going to be a static map of estuary locations with color based on the ecology score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = ecological)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Ecology Score")


```

```{r}
#This is going to be a static map of estuary locations with color based on the harvest score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = harvest)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Harvest Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the community engagement restoration score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = community_engagement_restotation)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Community Engagement Restoration Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the community engagment harvest score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = community_engagement_harvest)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Community Engagement Harvest Score")

```


```{r}
#This is going to be a static map of estuary locations with color based on the coastwide conservation score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = coastwide_conservation)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Coastwide Conservation Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the coastwide planner score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = coastwide_planner)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Coastwide Planner Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the restoration_practitioner score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = restoration_practitioner)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal()+
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Restoration Practictioner Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the community groups restoration score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = community_groups_restoration)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118)) +
  ggtitle("Community Groups Restoration Score")

```

```{r}
#This is going to be a static map of estuary locations with color based on the community groups harvest score

ggplot() +
  geom_sf(data = ca) +
  geom_sf(data = or) +
  geom_sf(data = wa) +
  geom_sf(data = nv) +
  geom_sf(data = estuary_sf, crs = 4326, size = 4, aes(color = community_groups_harvest)) +
  coord_sf(xlim = c(-124.5, -117.5), ylim = c(33, 48.5)) +
  scale_color_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118))+
  ggtitle("Community Groups Harvest Score")


```


```{r}
# Making maps with Shapefiles

pacific_estuary <- read_sf(dsn = here("locations"), layer = "Pacific_estuary_shore_dist") %>%
  st_transform(crs = 4326)
  

# st_crs(pacific_estuary) checking the coordingate reference system of pacific_esturary

#plot(pacific_estuary)

pacific_estuary_plot <- ggplot() +
  #geom_sf(data = ca) +
  #geom_sf(data = wa) +
  #geom_sf(data = or) +
  #geom_sf(data = nv) +
  geom_sf(data = pacific_estuary, aes(fill = shore_dist)) +
  scale_fill_gradientn(colors = c(
    "red",
    "green",
    "blue"
  )) +
  theme_minimal() +
  scale_x_continuous(breaks = c(-124, -121, -118))  

pacific_estuary_plot

#this map would look betrer if counties were dissolved.


```


